#include <stdio.h>
#include <string.h>
//definimos la estructura para los ficheros
typedef struct {
	char cuenca_hidrografica[50];
	char embalse_nombre[50];
	int mes;
	float dosmildoce;
	float dosmiltrece;
	float dosmilcatorce;
	float dosmilquince;
	float dosmildieciseis;
	float dosmildiecisiete;
	float dosmildieciocho;
	float dosmildiecinueve;
	float dosmilveinte;
	float dosmilveintiuno;

	char embalse_nom[50];
	float etotal;
	
} linea;

int main() {
	
// definimos las variables
	
int f=0,j=0, k=0, i;

int num_embalse, anyo, mes,num_cuenca, posiciones_cuencas[15] ;

float porcentaje;

linea cuenca[4236], embalse [353];


// abrimos los ficheros

FILE *tabla;
tabla = fopen("texto_proyecto.txt","r");
if (tabla == NULL) // Si el resultado es NULL mensaje de error
{
printf("Error al abrir el fichero.\n");
return -1;
}

FILE *lista;
lista = fopen("Embalses_capacidad.txt","r");
if (lista == NULL) // Si el resultado es NULL mensaje de error
{
printf("Error al abrir el fichero 2.\n");
return -1;
}


//leemos los ficheros

while (fscanf(tabla, "%s\t%s\t%i\t%f\t%f\t%f\t%f\t%f\t%f\t%f\t%f\t%f\t%f\n", cuenca[j].cuenca_hidrografica , cuenca[j].embalse_nombre , &cuenca[j].mes , &cuenca[j].dosmildoce, &cuenca[j].dosmiltrece, &cuenca[j].dosmilcatorce, &cuenca[j].dosmilquince, &cuenca[j].dosmildieciseis, &cuenca[j].dosmildiecisiete, &cuenca[j].dosmildieciocho,  &cuenca[j].dosmildiecinueve,  &cuenca[j].dosmilveinte,  &cuenca[j].dosmilveintiuno ) != EOF)
{
	
	//printf("Linea %i:\n", j);
	//printf("%s\t%s\t%i\t%f\t%f\t%f\t%f\t%f\t%f\t%f\n", cuenca[j].cuenca_hidrografica , cuenca[j].embalse_nombre , cuenca[j].mes , cuenca[j].dosmildoce, cuenca[j].dosmiltrece, cuenca[j].dosmilcatorce, cuenca[j].dosmilquince, cuenca[j].dosmildieciseis, cuenca[j].dosmildiecisiete, cuenca[j].dosmildieciocho,  cuenca[j].dosmildiecinueve,  cuenca[j].dosmilveinte,  cuenca[j].dosmilveintiuno );
	j++;
}

while ( fscanf(lista, "%s\n%f\n", embalse[k].embalse_nom , &embalse[k].etotal) !=EOF ){

	//printf("%s\t%.2f\n", embalse[k].embalse_nom, embalse[k].etotal );

	k++;

}


// Muestra cuencas a elegir
int p=0;
int a=0;
for (i=0;i<j;i++){
	a++;
	
	if (strcmp(cuenca[i].cuenca_hidrografica,cuenca[i-1].cuenca_hidrografica)!=0){
		p++;
		
		a = a/12;
		printf("%i- ", p);
		printf("%s\n",cuenca[i].cuenca_hidrografica);
		posiciones_cuencas[f]=i;
		f++;
	}
}

// condiciones para elegir cuenca

do{
	printf("\nIntroduce el numero de la cuenca: ");
	scanf("%i", &num_cuenca);

	if((0 >= num_cuenca) || ( num_cuenca > 16 )){
		printf ("\nNumero no valido, repite:\n");
	}

}

while ((0 >= num_cuenca) || ( num_cuenca > 16 ));

printf("a");
//Muestra embalses
int b=0;
p=0;
a=0;


if (strcmp(cuenca[i].cuenca_hidrografica,cuenca[i-1].cuenca_hidrografica) !=0){
for (i=0;i<j;i++){
	a++;
	if (i%12==0){
		
		p++;
		printf("%i- ", p);
		printf("%s\n", cuenca[i].embalse_nombre);
		
	}
}
}

//condiciones para elegir embalse
//cambiar el 353 por un valor variable
//el número que hay que poner va desde 1-número máx de embalses de la cuenca elegida, tengo que pensarlo
do{
	printf("\nIntroduce el numero del embalse: " );	
	
	
	scanf("%i", &num_embalse);

	if((0 > num_embalse) || ( num_embalse > 353 )){
		printf ("\nNumero no valido, repite:\n");
	}

}
while ((0 > num_embalse) || ( num_embalse > 353 ));


//embalse elegido

for(i=posiciones_cuencas[num_cuenca-1]+(num_embalse-1)*12;i<posiciones_cuencas[num_cuenca-1]+(num_embalse)*12;i++)
	{}printf("Tu embalse es: %s\n",cuenca[i-1].embalse_nombre) ;

//printf("Tu embalse es: %s\n",cuenca[posiciones_cuencas[num_cuenca-1]+(num_embalse-1)*12].embalse_nombre) ;

//fecha

printf("\n\nAhora vamos a seleccinar la fecha: ");

do{
	printf("\nIntroduce el anyo deseado 2012-2021: ");
		scanf("%i", &anyo);
	if((2012 > anyo) || ( anyo > 2021 )){
		printf ("\nNumero no valido, repite:\n");
	}
}
while ((2012 > anyo) || ( anyo > 2021 ));

do{
	printf("\nIntroduce el mes deseado: ");
		scanf("%i", &mes);
	if((1 > mes) || ( mes > 12 )){
		printf ("\nNumero no valido, repite:\n");
	}
}
while ((1 > mes) || ( mes > 12 ));

//casos por año


//fecha es para numerar el vector localizado, dato es para numerar el vector localizado
float dato, fecha;
	int r, s;
	int tamano = 5;
switch(anyo){
	case(2012):
		for (i=posiciones_cuencas[num_cuenca-1]+(num_embalse-1)*12;i<posiciones_cuencas[num_cuenca-1]+(num_embalse)*12;i++){
			fecha =  cuenca[mes-1].dosmildoce;
			dato = embalse[num_embalse-1].etotal;
			porcentaje = fecha*100/dato;
			
			//comprobación
			//printf("dato:%f\n", cuenca[i].dosmildoce);
			//1printf("linea:%i\n",i);
		}
		//printf("%.2f, %.2f",fecha,dato);
		printf("El embalse tiene una capacidad del %.2f %%", porcentaje);
		if (porcentaje<10){
			printf("Periodo de sequía.");
				/estamos trabajando en el sol
		}
}
//añadir los demás cases
//ponerlo en modo funciones
//lo intento tener para mañana
return 0;
}
